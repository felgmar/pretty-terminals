#!/bin/sh

setup_termux()
{
    test "${PREFIX}" != "/data/data/com.termux/files/usr" && \
        echo ":: ERROR: you are not using Android/Termux" && \
        exit 1

    test ! -d "/data/data/com.termux/files/usr" && \
        echo ":: ERROR: termux is not installed" && \
        exit 1

    apt install -y x11-repo

    apt full-upgrade -y && \
        apt install -y zsh tigervnc vim git xfce4 kitty thunar \
                        leafpad netsurf proot-distro iproute2 make nala

    if test ! -d "${HOME}/.oh-my-zsh"
    then
        curl -fsSL "https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh" | "${SHELL}"

    elif test ! -d "${HOME}/.oh-my-zsh/custom/themes/powerlevel10k"
    then
        zsh -c "source ${HOME}/.zshrc && \
                git clone --depth=1 https://github.com/romkatv/powerlevel10k.git \
                    ${ZSH_CUSTOM:-${HOME}/.oh-my-zsh/custom}/themes/powerlevel10k && \
                omz theme set powerlevel10k/powerlevel10k && \
                chsh -s zsh `whoami`"
    fi

    find config/etc/profile.d/*.sh -type f -exec install -Dm 644 {} "${PREFIX}/etc/profile.d/" \;

    return $?
}

setup_kitty()
{
    for f in curl kitty zsh
    do
        if test ! -x "`command -v $f`"
        then
            echo "Please install $f and try again" && exit 1
        fi
    done

    test ! -d "${HOME}/.config/kitty" && mkdir "${HOME}/.config/kitty"

    test ! -f "${HOME}/.config/kitty/kitty.conf" && \
        cp "config/kitty/kitty.conf" "${HOME}/.config/kitty/kitty.conf"

    test ! -d "${HOME}/.fonts" && mkdir $HOME/fonts

    jumpback=`pwd`
    cd "$HOME/.fonts"
    curl -fsSLO https://github.com/romkatv/powerlevel10k-media/raw/master/MesloLGS%20NF%20Regular.ttf
    curl -fsSLO https://github.com/romkatv/powerlevel10k-media/raw/master/MesloLGS%20NF%20Regular.ttf
    curl -fsSLO https://github.com/romkatv/powerlevel10k-media/raw/master/MesloLGS%20NF%20Bold.ttf
    curl -fsSLO https://github.com/romkatv/powerlevel10k-media/raw/master/MesloLGS%20NF%20Italic.ttf
    curl -fsSLO https://github.com/romkatv/powerlevel10k-media/raw/master/MesloLGS%20NF%20Bold%20Italic.ttf
    cd $jumpback && unset $jumpback

    if test ! -d "${HOME}/.oh-my-zsh"
    then
        curl -fsSL "https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh" | zsh
    elif test ! -d "${HOME}/.oh-my-zsh/custom/themes/powerlevel10k"
    then
        zsh -c "source ${HOME}/.zshrc && \
                git clone --depth=1 https://github.com/romkatv/powerlevel10k.git \
                    ${ZSH_CUSTOM:-${HOME}/.oh-my-zsh/custom}/themes/powerlevel10k && \
                omz theme set powerlevel10k/powerlevel10k && \
                chsh -s /bin/zsh `whoami`"
    fi

    test $? -eq 0 && echo "success" || echo "failure"

    return $?
}

setup_xterm()
{
    if test ! -x "`command -v xterm`"
    then
        echo "Please install XTerm and try again" && exit 1
    elif test ! -f "${HOME}/.Xresources"
    then
        cp ".config/xterm-settings" "${HOME}/.Xresources"
    fi

    xrdb -merge "${HOME}/.Xresources"

    test $? -eq 0 && echo "success" || echo "failure"

    return $?
}

while getopts 't:' arg
do
    case $arg in
        t) TERMINAL_TYPE=$OPTARG;;
        ?) echo "Usage: ${0} [-t TERMINAL_TYPE]"; exit $?;;
    esac
done

case $TERMINAL_TYPE in
    termux) setup_termux;;
    kitty) setup_kitty;;
    xterm) setup_xterm;;
esac
